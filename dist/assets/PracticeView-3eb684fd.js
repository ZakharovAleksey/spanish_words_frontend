import{_ as ce,g as K,C as k,a as D,k as M,h as v,W as N,i as R,M as z,L as G,j as C,l as W,m as q,n as ae,p as _e,q as de,r as n,o as i,s as b,b as t,w as s,t as ue,F as A,x,y as he,c as d,z as c,A as f,B as u,d as m,f as ge,v as me,D as Y,e as pe,E as fe,G as ye,H as we}from"./index-ce26998c.js";const ve={data(){return{is_parameters_select_disabled:!1,selected_gsheet:null,gsheets:[],gsheets_loading:!0,selected_category:null,categories:[],categories_loading:!1,selected_category_key:null,category_keys:[],category_key_loading:!1,selected_number:K[0],numbers:K,check_by_typing:!1,languages:[k.ENGLISH,k.SPANISH],selected_language:k.ENGLISH,words:{},forgotten_words:[],words_loading:!1,word_to_translation_pairs:new Map,words_queue:[],current_word_id:0,current_word_to_check:null,current_user_input:null,post_validation_lock:!1,is_user_input_correct:!0,current_error_message:"",current_message:"",success_percent:0,overlay:!1,is_lesson_complete:!1,lesson_icon:null,lesson_color:null,window:{width:0,height:0},top_class:""}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()},async beforeMount(){D.get(`${M}/api/spreadsheet/titles/`).then(o=>this.gsheets=o.data).catch(o=>this.showErrorToast(o)).finally(()=>this.gsheets_loading=!1)},watch:{selected_gsheet:function(){this.selected_category=null,this.selected_category_key=null,this.getThemes()},selected_category:function(){this.selected_category_key=null,this.getSubThemes()},window:{handler(){this.top_class=this.window.width<600?"flex-column":""},deep:!0}},computed:{isAllCategoriesSelected(){return this.selected_category_key==null||this.category_keys.length===0?!1:this.selected_category_key.length===this.category_keys.length}},methods:{async getThemes(){this.gsheets.length!==0&&this.gsheets.includes(this.selected_gsheet)&&(this.categories_loading=!0,D.get(`${M}/api/worksheet/columns/`,{params:{title:this.selected_gsheet}}).then(o=>this.categories=o.data).catch(o=>this.showErrorToast(o)).finally(()=>this.categories_loading=!1))},async getSubThemes(){if(this.gsheets.length===0||this.categories.length===0)return;let o=[];Object.entries(this.categories).forEach(([l,_])=>{o.push(_.id)}),o.includes(this.selected_category)&&(this.category_key_loading=!0,D.get(`${M}/api/worksheet/colums/unique_values/`,{params:{title:this.selected_gsheet,column_id:this.selected_category}}).then(l=>this.category_keys=l.data).catch(l=>this.showErrorToast(l)).finally(()=>this.category_key_loading=!1))},async getWords(){this.isPreRequestRequirementsSatisfied(!0,!0,!0)&&(this.cleanUpLessonData(),this.is_parameters_select_disabled=!0,this.words_loading=!0,D.get(`${M}/api/worksheet/random_values/`,{params:{title:this.selected_gsheet,filter_column_id:this.selected_category,template:this.selected_category_key.join("|"),column_ids:"0,1",count:this.selected_number}}).then(o=>{for(const[e,a]of Object.entries(o.data)){const h=parseInt(e)===0?k.SPANISH:k.ENGLISH;this.words[h]=a.map(p=>({word:p,color:v.GOOD,icon:"mdi-emoticon"}))}const l=this.selected_language===k.SPANISH?0:1,_=l===1?0:1,V=o.data[l].length;for(let e=0;e<V;++e)this.word_to_translation_pairs.set(o.data[l][e],o.data[_][e]);this.check_by_typing||(this.words_queue=[...o.data[l]],this.forgotten_words=[...o.data[l]],this.current_word_to_check=this.words_queue[this.current_word_id])}).catch(o=>this.showErrorToast(o)).finally(()=>this.words_loading=!1))},updateWordStatus(o){const l=o.word,_=this.forgotten_words.indexOf(l);_!==-1?this.forgotten_words.splice(_,1):this.forgotten_words.push(l),o.color=o.color===v.GOOD?v.BAD:v.GOOD,o.icon=o.icon===N.REMEMBERED?N.FORGOTTEN:N.REMEMBERED},onCompleteClick(){const o=this.word_to_translation_pairs.size-this.forgotten_words.length,l=this.word_to_translation_pairs.size;this.success_percent=(o/l).toFixed(1)*R;const _=this.success_percent/R*100,V=this.chooseLessonIcons(_);this.lesson_icon=V.icon,this.lesson_color=V.color,this.overlay=!0},onLessonComplete(){this.overlay=!this.overlay,this.is_lesson_complete=!0,this.is_parameters_select_disabled=!1},generateUserMessageOnLessonComplete(){const o=this.success_percent/R*100,l=`You remember ${o}% of the words.`;return o>z.GOOD?l+G.GOOD:o>z.MEDIUM?l+G.MEDIUM:l+G.BAD},isPreRequestRequirementsSatisfied(o=!1,l=!1,_=!1){return o&&this.selected_gsheet===null?(C().info(W+"google sheet"),!1):l&&this.selected_category===null?(C().info(W+"words filtering key"),!1):_&&(this.selected_category_key===null||this.selected_category_key.length===0)?(C().info(W+"words category"),!1):!0},cleanUpLessonData(){this.words={},this.forgotten_words=[],this.word_to_translation_pairs.clear(),this.is_lesson_complete=!1,this.words_queue=[],this.current_word_id=0,this.current_word_to_check=null,this.current_user_input=null,this.post_validation_lock=!1,this.is_user_input_correct=!0,this.current_error_message="",this.current_message=""},chooseLessonIcons(o){return o>z.GOOD?{icon:q.GOOD,color:v.GOOD}:o>z.MEDIUM?{icon:q.MEDIUM,color:v.MEDIUM}:{icon:q.BAD,color:v.BAD}},transformWord(o){return o.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},checkTranslation(){const o=this.word_to_translation_pairs.get(this.current_word_to_check);if(this.is_user_input_correct=this.transformWord(this.current_user_input)===this.transformWord(o),this.is_user_input_correct){const l=this.forgotten_words.indexOf(this.current_word_to_check);l!==-1&&this.forgotten_words.splice(l,1)}this.post_validation_lock=!0,this.is_user_input_correct?this.current_message="Great job!":this.current_error_message=`Sorry, expected translation: ${o}`},getNextWord(){if(!this.post_validation_lock){this.checkTranslation();return}if(this.current_word_id===this.words_queue.length-1){this.onCompleteClick();return}this.current_word_id++,this.current_word_to_check=this.words_queue[this.current_word_id],this.current_user_input="",this.is_user_input_correct="",this.current_error_message="",this.current_message="",this.is_user_input_correct=!0,this.post_validation_lock=!1},showErrorToast(o){console.log(o),o.response.status===401?(C().info(ae),setTimeout(()=>{this.$router.push("/login")},_e)):C().error(de)},destroyed(){window.removeEventListener("resize",this.handleResize)},handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},selectAll(){this.selected_category_key==null||this.selected_category_key.length!==this.category_keys.length?this.selected_category_key=[...this.category_keys]:this.selected_category_key=[]}}},T=o=>(ye("data-v-5ea38b26"),o=o(),we(),o),ke={key:1,class:"text-grey text-caption align-self-center"},be={key:1},xe={class:"my-2 text-h6"},Ve=T(()=>c("thead",null,[c("tr",null,[c("th",{class:"text-center"}," Original "),c("th",{class:"text-center"}," Translation ")])],-1)),Ce={class:"text-center"},Oe={class:"text-center"},Ee=T(()=>c("div",{class:"d-flex justify-center mt-auto text-h5"},"Lesson complete!",-1)),Se={class:"d-flex flex-column align-center"},De={class:"text-h2 mt-5"},Me=T(()=>c("span",{class:"text-h6 ml-n3"},"/5",-1)),ze={class:"px-3 text-subtitle-1 text-center"},Te=T(()=>c("br",null,null,-1));function Ie(o,l,_,V,e,a){const h=n("v-icon"),p=n("v-tooltip"),O=n("v-select"),y=n("v-list-item"),X=n("v-checkbox-btn"),J=n("v-divider"),B=n("v-chip"),Q=n("v-autocomplete"),Z=n("v-checkbox"),$=n("v-list"),g=n("v-row"),E=n("v-btn"),I=n("v-col"),j=n("v-card-title"),ee=n("v-alert"),L=n("v-card-item"),w=n("v-card"),H=n("v-progress-circular"),S=n("v-card-text"),te=n("v-progress-linear"),P=n("v-text-field"),se=n("v-form"),F=n("v-card-actions"),oe=n("v-container"),le=n("v-card-subtitle"),re=n("v-table"),ne=n("v-rating"),ie=n("v-overlay");return i(),b(A,null,[t(g,{class:ue(e.top_class)},{default:s(()=>[t(I,{class:"grow d-flex flex-column flex-nowrap",xs:"12",md:"4"},{default:s(()=>[t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[t($,null,{default:s(()=>[t(y,null,{prepend:s(()=>[t(p,{text:"Select the google sheet to retrieve words",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-google-spreadsheet",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(O,{label:"Google sheet",modelValue:e.selected_gsheet,"onUpdate:modelValue":l[0]||(l[0]=r=>e.selected_gsheet=r),items:e.gsheets,loading:e.gsheets_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","loading","disabled"])]),_:1}),t(y,null,{prepend:s(()=>[t(p,{text:"Column with the words categories",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-shape-outline",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(O,{label:"Google sheet base column",modelValue:e.selected_category,"onUpdate:modelValue":l[1]||(l[1]=r=>e.selected_category=r),items:e.categories,"item-title":"text","item-value":"id",loading:e.categories_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","loading","disabled"])]),_:1}),t(y,null,{prepend:s(()=>[t(p,{text:"Category for the words filtering",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-shape-plus",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(Q,{label:"Words categories",modelValue:e.selected_category_key,"onUpdate:modelValue":l[2]||(l[2]=r=>e.selected_category_key=r),items:e.category_keys,loading:e.category_key_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,multiple:"","hide-details":"true",variant:"outlined","menu-props":{maxWidth:5},class:"my-2"},he({selection:s(({item:r,index:U})=>[U<2?(i(),d(B,{key:0},{default:s(()=>[c("span",null,f(r.title),1)]),_:2},1024)):u("",!0),U===2?(i(),b("span",ke," (+"+f(e.selected_category_key.length-2)+" others) ",1)):u("",!0)]),_:2},[e.category_keys.length!==0?{name:"prepend-item",fn:s(()=>[t(y,{title:"select all",onClick:a.selectAll},{prepend:s(()=>[t(X,{"model-value":a.isAllCategoriesSelected},null,8,["model-value"])]),_:1},8,["onClick"]),t(J,{class:"my-1"})]),key:"0"}:void 0]),1032,["modelValue","items","loading","disabled"])]),_:1}),t(y,null,{prepend:s(()=>[t(p,{text:"Original language to translate from",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-translate",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(O,{label:"Original language",modelValue:e.selected_language,"onUpdate:modelValue":l[3]||(l[3]=r=>e.selected_language=r),items:e.languages,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","disabled"])]),_:1}),t(y,null,{prepend:s(()=>[t(p,{text:"Number of words to repeat",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-counter",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(O,{label:"Number of words to repeat",modelValue:e.selected_number,"onUpdate:modelValue":l[4]||(l[4]=r=>e.selected_number=r),items:e.numbers,disabled:e.is_parameters_select_disabled,variant:"outlined","hide-details":!0,class:"my-2"},null,8,["modelValue","items","disabled"])]),_:1}),t(y,null,{prepend:s(()=>[t(p,{text:"Enable, if you prefer repeat words without typing their translation",location:"bottom"},{activator:s(({props:r})=>[t(h,x({icon:"mdi-draw",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(Z,{label:"Don't check words translation",modelValue:e.check_by_typing,"onUpdate:modelValue":l[5]||(l[5]=r=>e.check_by_typing=r),disabled:e.is_parameters_select_disabled,variant:"outlined","hide-details":!0,class:"my-2"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[t(E,{rounded:"lg",size:"large",class:"text-uppercase my-1 my-button",text:"start",onClick:a.getWords},null,8,["onClick"])]),_:1})]),_:1}),t(I,{class:"grow d-flex flex-column flex-nowrap",xs:"12",md:"7"},{default:s(()=>[t(g,{cols:"12"},{default:s(()=>[e.is_lesson_complete?u("",!0):(i(),d(w,{key:0,elevation:"0",width:"100%"},{default:s(()=>[t(L,null,{default:s(()=>[t(j,null,{default:s(()=>[m(" Words to repeat ")]),_:1}),ge(t(ee,{"border-color":"blue",title:"Note",text:"Click on the words, translations of which you do not remember.",border:"start",class:"text-subtitle-2 mt-6",closable:"","close-icon":"mdi-close-circle-outline",icon:"mdi-cursor-default-click-outline"},null,512),[[me,Object.keys(e.words).length!==0&&e.check_by_typing]])]),_:1})]),_:1})),!e.is_lesson_complete&&e.check_by_typing?(i(),d(w,{key:1,elevation:"0",width:"100%"},{default:s(()=>[t(S,null,{default:s(()=>[t(I,{cols:"12"},{default:s(()=>[t(g,{cols:"12",justify:"center"},{default:s(()=>[e.words_loading?(i(),d(H,{key:0,class:"align-center justify-center",indeterminate:""})):(i(!0),b(A,{key:1},Y(e.words[e.selected_language],r=>(i(),d(B,{"prepend-icon":r.icon,class:"ma-1",color:r.color,size:"large",onClick:U=>a.updateWordStatus(r)},{default:s(()=>[m(f(r.word),1)]),_:2},1032,["prepend-icon","color","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})):u("",!0),!e.is_lesson_complete&&!e.check_by_typing?(i(),d(w,{key:2,elevation:"0",width:"100%"},{default:s(()=>[t(S,null,{default:s(()=>[t(oe,null,{default:s(()=>[e.words_loading?(i(),d(g,{key:0,cols:"12",justify:"center"},{default:s(()=>[t(H,{class:"align-center justify-center",indeterminate:""})]),_:1})):u("",!0),!e.words_loading&&Object.keys(e.words).length!==0?(i(),b("div",be,[t(g,{cols:"12","align-content":"center"},{default:s(()=>[c("p",xe,"Your progress: "+f(Math.round(e.current_word_id/e.words_queue.length*100))+" %",1),t(te,{modelValue:e.current_word_id,"onUpdate:modelValue":l[6]||(l[6]=r=>e.current_word_id=r),max:e.words_queue.length,height:12,rounded:"",class:"pa-0 mb-10",color:"green"},null,8,["modelValue","max"])]),_:1}),t(g,{cols:"12",justify:"center",align:"center"},{default:s(()=>[t(w,{rounded:"lg",class:"pa-5",width:"400"},{default:s(()=>[t(P,{label:"Original",variant:"outlined",modelValue:e.current_word_to_check,"onUpdate:modelValue":l[7]||(l[7]=r=>e.current_word_to_check=r),readonly:!0},null,8,["modelValue"]),t(se,{"validate-on":"submit lazy",onSubmit:pe(a.checkTranslation,["prevent"])},{default:s(()=>[t(P,{modelValue:e.current_user_input,"onUpdate:modelValue":l[8]||(l[8]=r=>e.current_user_input=r),"persistent-hint":!0,label:"Translation",variant:"outlined",onKeyup:fe(a.checkTranslation,["enter"]),readonly:e.post_validation_lock,error:!e.is_user_input_correct,"error-messages":e.current_error_message,messages:e.current_message},null,8,["modelValue","onKeyup","readonly","error","error-messages","messages"])]),_:1},8,["onSubmit"]),t(F,{class:"align-center justify-center"},{default:s(()=>[t(E,{rounded:"lg",size:"large",class:"text-uppercase mt-1 my-button",text:"NEXT",onClick:a.getNextWord,variant:"elevated"},null,8,["onClick"])]),_:1})]),_:1})]),_:1})])):u("",!0)]),_:1})]),_:1})]),_:1})):u("",!0),e.is_lesson_complete&&e.forgotten_words.length!==0?(i(),d(w,{key:3,elevation:"0",class:"w-100"},{default:s(()=>[t(L,null,{default:s(()=>[t(j,null,{default:s(()=>[m(" Forgotten words ")]),_:1}),t(le,null,{default:s(()=>[m(" Here are words for you to repeat to get all five stars next time! ")]),_:1})]),_:1})]),_:1})):u("",!0),e.is_lesson_complete&&e.forgotten_words.length!==0?(i(),d(w,{key:4,elevation:"0",class:"w-100","max-height":"400px"},{default:s(()=>[t(S,null,{default:s(()=>[t(re,{"fixed-header":!0,height:"300px"},{default:s(()=>[Ve,c("tbody",null,[(i(!0),b(A,null,Y(e.forgotten_words,r=>(i(),b("tr",null,[c("td",Ce,f(r),1),c("td",Oe,f(e.word_to_translation_pairs.get(r)),1)]))),256))])]),_:1})]),_:1})]),_:1})):u("",!0)]),_:1}),t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[!e.is_lesson_complete&&Object.keys(e.words).length!==0?(i(),d(E,{key:0,rounded:"lg",size:"large",class:"text-uppercase my-1 my-button",onClick:a.onCompleteClick},{default:s(()=>[m("complete")]),_:1},8,["onClick"])):u("",!0)]),_:1})]),_:1})]),_:1},8,["class"]),t(ie,{modelValue:e.overlay,"onUpdate:modelValue":l[10]||(l[10]=r=>e.overlay=r),contained:!0,class:"align-center justify-center"},{default:s(()=>[t(w,{rounded:"lg",width:"360"},{default:s(()=>[t(L,null,{default:s(()=>[t(j,null,{default:s(()=>[Ee]),_:1})]),_:1}),t(S,null,{default:s(()=>[c("div",Se,[t(h,{icon:e.lesson_icon,style:{"font-size":"250px"},color:e.lesson_color},null,8,["icon","color"]),c("div",De,[m(f(e.success_percent)+" ",1),Me]),t(ne,{modelValue:e.success_percent,"onUpdate:modelValue":l[9]||(l[9]=r=>e.success_percent=r),color:"yellow-darken-3","half-increments":!0,readonly:!0},null,8,["modelValue"]),c("p",ze,[m(" Great job! "),Te,m(" "+f(a.generateUserMessageOnLessonComplete()),1)])])]),_:1}),t(F,{class:"align-center justify-center"},{default:s(()=>[t(E,{onClick:a.onLessonComplete,class:"text-uppercase my-1 my-button",rounded:"lg",size:"large",variant:"elevated"},{default:s(()=>[m("done")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Le=ce(ve,[["render",Ie],["__scopeId","data-v-5ea38b26"]]);export{Le as default};
