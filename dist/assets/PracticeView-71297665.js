import{_ as ae,g as X,C as b,a as D,k as M,h as N,i as v,W as R,j as G,M as T,L as W,l as O,m as q,n as A,p as _e,q as de,s as ue,r as n,o as c,t as x,b as t,w as s,x as he,F as B,y as V,z as ge,c as d,A as _,B as y,D as u,d as m,f as me,v as pe,E as J,e as fe,G as ye,H as we,I as ve}from"./index-2914078e.js";const ke={data(){return{is_parameters_select_disabled:!1,selected_gsheet:null,gsheets:[],gsheets_loading:!0,selected_category:null,categories:[],categories_loading:!1,selected_category_key:null,category_keys:[],category_key_loading:!1,select_latest_words:!1,selected_number:X[0],numbers:X,check_by_typing:!1,languages:[b.ENGLISH,b.SPANISH],selected_language:b.ENGLISH,words:{},forgotten_words:[],words_loading:!1,word_to_translation_pairs:new Map,words_queue:[],current_word_id:0,current_word_to_check:null,current_user_input:null,post_validation_lock:!1,is_user_input_correct:!0,current_error_message:"",current_message:"",success_percent:0,overlay:!1,is_lesson_complete:!1,lesson_icon:null,lesson_color:null,window:{width:0,height:0},top_class:""}},created(){window.addEventListener("resize",this.handleResize),this.handleResize()},async mounted(){D.get(`${M}/api/spreadsheet/titles/`).then(l=>this.gsheets=l.data).catch(l=>this.showErrorToast(l)).finally(()=>this.gsheets_loading=!1)},watch:{selected_gsheet:function(){this.selected_category=null,this.selected_category_key=null,this.getThemes()},selected_category:function(){this.selected_category_key=null,this.getSubThemes()},selected_category_key:function(){if(this.selected_category_key==null||this.selected_category_key.length===0){this.select_latest_words=!1;return}if(this.select_latest_words&&this.selected_category_key.length>1){const l=this.selected_category_key.indexOf(N);l!=-1&&this.selected_category_key.splice(l,1),this.select_latest_words=!1}},window:{handler(){this.top_class=this.window.width<600?"flex-column":""},deep:!0}},computed:{isAllCategoriesSelected(){return this.selected_category_key==null||this.category_keys.length===0?!1:this.selected_category_key.length===this.category_keys.length}},methods:{async getThemes(){this.gsheets.length!==0&&this.gsheets.includes(this.selected_gsheet)&&(this.categories_loading=!0,D.get(`${M}/api/worksheet/columns/`,{params:{title:this.selected_gsheet}}).then(l=>this.categories=l.data).catch(l=>this.showErrorToast(l)).finally(()=>this.categories_loading=!1))},async getSubThemes(){if(this.gsheets.length===0||this.categories.length===0)return;let l=[];Object.entries(this.categories).forEach(([o,a])=>{l.push(a.id)}),l.includes(this.selected_category)&&(this.category_key_loading=!0,D.get(`${M}/api/worksheet/colums/unique_values/`,{params:{title:this.selected_gsheet,column_id:this.selected_category}}).then(o=>this.category_keys=o.data).catch(o=>this.showErrorToast(o)).finally(()=>this.category_key_loading=!1))},async getWords(){if(!this.isPreRequestRequirementsSatisfied(!0,!0,!0))return;this.cleanUpLessonData(),this.is_parameters_select_disabled=!0,this.words_loading=!0;const l=this.select_latest_words?"latest_values":"random_values";D.get(`${M}/api/worksheet/${l}/`,{params:{title:this.selected_gsheet,filter_column_id:this.selected_category,template:this.selected_category_key.join("|"),column_ids:"0,1",count:this.selected_number}}).then(o=>{for(const[i,h]of Object.entries(o.data)){const p=parseInt(i)===0?b.SPANISH:b.ENGLISH;this.words[p]=h.map(k=>({word:k,color:v.GOOD,icon:"mdi-emoticon"}))}const a=this.selected_language===b.SPANISH?0:1,C=a===1?0:1,e=o.data[a].length;for(let i=0;i<e;++i)this.word_to_translation_pairs.set(o.data[a][i],o.data[C][i]);this.check_by_typing||(this.words_queue=[...o.data[a]],this.forgotten_words=[...o.data[a]],this.current_word_to_check=this.words_queue[this.current_word_id])}).catch(o=>this.showErrorToast(o)).finally(()=>this.words_loading=!1)},updateWordStatus(l){const o=l.word,a=this.forgotten_words.indexOf(o);a!==-1?this.forgotten_words.splice(a,1):this.forgotten_words.push(o),l.color=l.color===v.GOOD?v.BAD:v.GOOD,l.icon=l.icon===R.REMEMBERED?R.FORGOTTEN:R.REMEMBERED},onCompleteClick(){const l=this.word_to_translation_pairs.size-this.forgotten_words.length,o=this.word_to_translation_pairs.size;this.success_percent=(l/o).toFixed(1)*G;const a=this.success_percent/G*100,C=this.chooseLessonIcons(a);this.lesson_icon=C.icon,this.lesson_color=C.color,this.overlay=!0},onLessonComplete(){this.overlay=!this.overlay,this.is_lesson_complete=!0,this.is_parameters_select_disabled=!1},generateUserMessageOnLessonComplete(){const l=Math.max(this.success_percent/G*100,0),o=`You remember ${l}% of the words.`;return l>T.GOOD?o+W.GOOD:l>T.MEDIUM?o+W.MEDIUM:o+W.BAD},isPreRequestRequirementsSatisfied(l=!1,o=!1,a=!1){return l&&this.selected_gsheet===null?(O().info(q+"google sheet"),!1):o&&this.selected_category===null?(O().info(q+"words filtering key"),!1):a&&(this.selected_category_key===null||this.selected_category_key.length===0)?(O().info(q+"words category"),!1):!0},cleanUpLessonData(){this.words={},this.forgotten_words=[],this.word_to_translation_pairs.clear(),this.is_lesson_complete=!1,this.words_queue=[],this.current_word_id=0,this.current_word_to_check=null,this.current_user_input=null,this.post_validation_lock=!1,this.is_user_input_correct=!0,this.current_error_message="",this.current_message=""},chooseLessonIcons(l){return l>T.GOOD?{icon:A.GOOD,color:v.GOOD}:l>T.MEDIUM?{icon:A.MEDIUM,color:v.MEDIUM}:{icon:A.BAD,color:v.BAD}},transformWord(l){return l.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"")},checkTranslation(){const l=this.word_to_translation_pairs.get(this.current_word_to_check);if(this.is_user_input_correct=this.transformWord(this.current_user_input)===this.transformWord(l),this.is_user_input_correct){const o=this.forgotten_words.indexOf(this.current_word_to_check);o!==-1&&this.forgotten_words.splice(o,1)}this.post_validation_lock=!0,this.is_user_input_correct?this.current_message="Great job!":this.current_error_message=`Sorry, expected translation: ${l}`},getNextWord(){if(!this.post_validation_lock){this.checkTranslation();return}if(this.current_word_id===this.words_queue.length-1){this.onCompleteClick();return}this.current_word_id++,this.current_word_to_check=this.words_queue[this.current_word_id],this.current_user_input="",this.is_user_input_correct="",this.current_error_message="",this.current_message="",this.is_user_input_correct=!0,this.post_validation_lock=!1},showErrorToast(l){console.log(l),l.response.status===401?(O().info(_e),setTimeout(()=>{this.$router.push("/login")},de)):O().error(ue)},destroyed(){window.removeEventListener("resize",this.handleResize)},handleResize(){this.window.width=window.innerWidth,this.window.height=window.innerHeight},selectAll(){this.selected_category_key==null||this.selected_category_key.length!==this.category_keys.length?this.selected_category_key=[...this.category_keys]:this.selected_category_key=[]},selectLatest(){if(!this.select_latest_words)this.selected_category_key=[N];else{const l=this.selected_category_key.indexOf(N);l!=-1&&this.selected_category_key.splice(l,1)}this.select_latest_words=!this.select_latest_words}}},z=l=>(we("data-v-5c341e1c"),l=l(),ve(),l),be={key:1,class:"text-grey text-caption align-self-center"},xe={key:1},Ve={class:"my-2 text-h6"},Ce=z(()=>_("thead",null,[_("tr",null,[_("th",{class:"text-center"}," Original "),_("th",{class:"text-center"}," Translation ")])],-1)),Oe={class:"text-center"},Ee={class:"text-center"},Se=z(()=>_("div",{class:"d-flex justify-center mt-auto text-h5"},"Lesson complete!",-1)),De={class:"d-flex flex-column align-center"},Me={class:"text-h2 mt-5"},Te=z(()=>_("span",{class:"text-h6 ml-n3"},"/5",-1)),ze={class:"px-3 text-subtitle-1 text-center"},Le=z(()=>_("br",null,null,-1));function Ie(l,o,a,C,e,i){const h=n("v-icon"),p=n("v-tooltip"),k=n("v-select"),f=n("v-list-item"),H=n("v-checkbox-btn"),Q=n("v-divider"),P=n("v-chip"),Z=n("v-autocomplete"),$=n("v-checkbox"),ee=n("v-list"),g=n("v-row"),E=n("v-btn"),L=n("v-col"),I=n("v-card-title"),te=n("v-alert"),j=n("v-card-item"),w=n("v-card"),F=n("v-progress-circular"),S=n("v-card-text"),se=n("v-progress-linear"),K=n("v-text-field"),oe=n("v-form"),Y=n("v-card-actions"),le=n("v-container"),re=n("v-card-subtitle"),ne=n("v-table"),ie=n("v-rating"),ce=n("v-overlay");return c(),x(B,null,[t(g,{class:he(e.top_class)},{default:s(()=>[t(L,{class:"grow d-flex flex-column flex-nowrap",xs:"12",md:"4"},{default:s(()=>[t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[t(ee,null,{default:s(()=>[t(f,null,{prepend:s(()=>[t(p,{text:"Select the google sheet to retrieve words",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-google-spreadsheet",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(k,{label:"Google sheet",modelValue:e.selected_gsheet,"onUpdate:modelValue":o[0]||(o[0]=r=>e.selected_gsheet=r),items:e.gsheets,loading:e.gsheets_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","loading","disabled"])]),_:1}),t(f,null,{prepend:s(()=>[t(p,{text:"Column with the words categories",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-shape-outline",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(k,{label:"Google sheet base column",modelValue:e.selected_category,"onUpdate:modelValue":o[1]||(o[1]=r=>e.selected_category=r),items:e.categories,"item-title":"text","item-value":"id",loading:e.categories_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","loading","disabled"])]),_:1}),t(f,null,{prepend:s(()=>[t(p,{text:"Category for the words filtering",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-shape-plus",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(Z,{label:"Words categories",modelValue:e.selected_category_key,"onUpdate:modelValue":o[2]||(o[2]=r=>e.selected_category_key=r),items:e.category_keys,loading:e.category_key_loading,clearable:!0,"append-icon":"",disabled:e.is_parameters_select_disabled,multiple:"","hide-details":"true",variant:"outlined","menu-props":{maxWidth:5},class:"my-2"},ge({selection:s(({item:r,index:U})=>[U<2?(c(),d(P,{key:0},{default:s(()=>[_("span",null,y(r.title),1)]),_:2},1024)):u("",!0),U===2?(c(),x("span",be," (+"+y(e.selected_category_key.length-2)+" others) ",1)):u("",!0)]),_:2},[e.category_keys.length!==0?{name:"prepend-item",fn:s(()=>[t(f,{title:"all categories",onClick:i.selectAll},{prepend:s(()=>[t(H,{"model-value":i.isAllCategoriesSelected},null,8,["model-value"])]),_:1},8,["onClick"]),t(f,{title:"latest added words",onClick:i.selectLatest},{prepend:s(()=>[t(H,{"model-value":e.select_latest_words},null,8,["model-value"])]),_:1},8,["onClick"]),t(Q,{class:"my-1"})]),key:"0"}:void 0]),1032,["modelValue","items","loading","disabled"])]),_:1}),t(f,null,{prepend:s(()=>[t(p,{text:"Original language to translate from",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-translate",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(k,{label:"Original language",modelValue:e.selected_language,"onUpdate:modelValue":o[3]||(o[3]=r=>e.selected_language=r),items:e.languages,"append-icon":"",disabled:e.is_parameters_select_disabled,"hide-details":!0,variant:"outlined",class:"my-2"},null,8,["modelValue","items","disabled"])]),_:1}),t(f,null,{prepend:s(()=>[t(p,{text:"Number of words to repeat",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-counter",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t(k,{label:"Number of words to repeat",modelValue:e.selected_number,"onUpdate:modelValue":o[4]||(o[4]=r=>e.selected_number=r),items:e.numbers,disabled:e.is_parameters_select_disabled,variant:"outlined","hide-details":!0,class:"my-2"},null,8,["modelValue","items","disabled"])]),_:1}),t(f,null,{prepend:s(()=>[t(p,{text:"Enable, if you prefer repeat words without typing their translation",location:"bottom"},{activator:s(({props:r})=>[t(h,V({icon:"mdi-draw",size:"x-large"},r),null,16)]),_:1})]),default:s(()=>[t($,{label:"Don't check words translation",modelValue:e.check_by_typing,"onUpdate:modelValue":o[5]||(o[5]=r=>e.check_by_typing=r),disabled:e.is_parameters_select_disabled,variant:"outlined","hide-details":!0,class:"my-2"},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[t(E,{rounded:"lg",size:"large",class:"text-uppercase my-1 my-button",text:"start",onClick:i.getWords},null,8,["onClick"])]),_:1})]),_:1}),t(L,{class:"grow d-flex flex-column flex-nowrap",xs:"12",md:"7"},{default:s(()=>[t(g,{cols:"12"},{default:s(()=>[e.is_lesson_complete?u("",!0):(c(),d(w,{key:0,elevation:"0",width:"100%"},{default:s(()=>[t(j,null,{default:s(()=>[t(I,null,{default:s(()=>[m(" Words to repeat ")]),_:1}),me(t(te,{"border-color":"blue",title:"Note",text:"Click on the words, translations of which you do not remember.",border:"start",class:"text-subtitle-2 mt-6",closable:"","close-icon":"mdi-close-circle-outline",icon:"mdi-cursor-default-click-outline"},null,512),[[pe,Object.keys(e.words).length!==0&&e.check_by_typing]])]),_:1})]),_:1})),!e.is_lesson_complete&&e.check_by_typing?(c(),d(w,{key:1,elevation:"0",width:"100%"},{default:s(()=>[t(S,null,{default:s(()=>[t(L,{cols:"12"},{default:s(()=>[t(g,{cols:"12",justify:"center"},{default:s(()=>[e.words_loading?(c(),d(F,{key:0,class:"align-center justify-center",indeterminate:""})):(c(!0),x(B,{key:1},J(e.words[e.selected_language],r=>(c(),d(P,{"prepend-icon":r.icon,class:"ma-1",color:r.color,size:"large",onClick:U=>i.updateWordStatus(r)},{default:s(()=>[m(y(r.word),1)]),_:2},1032,["prepend-icon","color","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})):u("",!0),!e.is_lesson_complete&&!e.check_by_typing?(c(),d(w,{key:2,elevation:"0",width:"100%"},{default:s(()=>[t(S,null,{default:s(()=>[t(le,null,{default:s(()=>[e.words_loading?(c(),d(g,{key:0,cols:"12",justify:"center"},{default:s(()=>[t(F,{class:"align-center justify-center",indeterminate:""})]),_:1})):u("",!0),!e.words_loading&&Object.keys(e.words).length!==0?(c(),x("div",xe,[t(g,{cols:"12","align-content":"center"},{default:s(()=>[_("p",Ve,"Your progress: "+y(Math.round(e.current_word_id/e.words_queue.length*100))+" %",1),t(se,{modelValue:e.current_word_id,"onUpdate:modelValue":o[6]||(o[6]=r=>e.current_word_id=r),max:e.words_queue.length,height:12,rounded:"",class:"pa-0 mb-10",color:"green"},null,8,["modelValue","max"])]),_:1}),t(g,{cols:"12",justify:"center",align:"center"},{default:s(()=>[t(w,{rounded:"lg",class:"pa-5",width:"400"},{default:s(()=>[t(K,{label:"Original",variant:"outlined",modelValue:e.current_word_to_check,"onUpdate:modelValue":o[7]||(o[7]=r=>e.current_word_to_check=r),readonly:!0},null,8,["modelValue"]),t(oe,{"validate-on":"submit lazy",onSubmit:fe(i.checkTranslation,["prevent"])},{default:s(()=>[t(K,{modelValue:e.current_user_input,"onUpdate:modelValue":o[8]||(o[8]=r=>e.current_user_input=r),"persistent-hint":!0,label:"Translation",variant:"outlined",onKeyup:ye(i.checkTranslation,["enter"]),readonly:e.post_validation_lock,error:!e.is_user_input_correct,"error-messages":e.current_error_message,messages:e.current_message},null,8,["modelValue","onKeyup","readonly","error","error-messages","messages"])]),_:1},8,["onSubmit"]),t(Y,{class:"align-center justify-center"},{default:s(()=>[t(E,{rounded:"lg",size:"large",class:"text-uppercase mt-1 my-button",text:"NEXT",onClick:i.getNextWord,variant:"elevated"},null,8,["onClick"])]),_:1})]),_:1})]),_:1})])):u("",!0)]),_:1})]),_:1})]),_:1})):u("",!0),e.is_lesson_complete&&e.forgotten_words.length!==0?(c(),d(w,{key:3,elevation:"0",class:"w-100"},{default:s(()=>[t(j,null,{default:s(()=>[t(I,null,{default:s(()=>[m(" Forgotten words ")]),_:1}),t(re,null,{default:s(()=>[m(" Here are words for you to repeat to get all five stars next time! ")]),_:1})]),_:1})]),_:1})):u("",!0),e.is_lesson_complete&&e.forgotten_words.length!==0?(c(),d(w,{key:4,elevation:"0",class:"w-100","max-height":"400px"},{default:s(()=>[t(S,null,{default:s(()=>[t(ne,{"fixed-header":!0,height:"300px"},{default:s(()=>[Ce,_("tbody",null,[(c(!0),x(B,null,J(e.forgotten_words,r=>(c(),x("tr",null,[_("td",Oe,y(r),1),_("td",Ee,y(e.word_to_translation_pairs.get(r)),1)]))),256))])]),_:1})]),_:1})]),_:1})):u("",!0)]),_:1}),t(g,{cols:"12",align:"end",justify:"center"},{default:s(()=>[!e.is_lesson_complete&&Object.keys(e.words).length!==0?(c(),d(E,{key:0,rounded:"lg",size:"large",class:"text-uppercase my-1 my-button",onClick:i.onCompleteClick},{default:s(()=>[m("complete")]),_:1},8,["onClick"])):u("",!0)]),_:1})]),_:1})]),_:1},8,["class"]),t(ce,{modelValue:e.overlay,"onUpdate:modelValue":o[10]||(o[10]=r=>e.overlay=r),contained:!0,class:"align-center justify-center"},{default:s(()=>[t(w,{rounded:"lg",width:"360"},{default:s(()=>[t(j,null,{default:s(()=>[t(I,null,{default:s(()=>[Se]),_:1})]),_:1}),t(S,null,{default:s(()=>[_("div",De,[t(h,{icon:e.lesson_icon,style:{"font-size":"250px"},color:e.lesson_color},null,8,["icon","color"]),_("div",Me,[m(y(e.success_percent)+" ",1),Te]),t(ie,{modelValue:e.success_percent,"onUpdate:modelValue":o[9]||(o[9]=r=>e.success_percent=r),color:"yellow-darken-3","half-increments":!0,readonly:!0},null,8,["modelValue"]),_("p",ze,[m(" Great job! "),Le,m(" "+y(i.generateUserMessageOnLessonComplete()),1)])])]),_:1}),t(Y,{class:"align-center justify-center"},{default:s(()=>[t(E,{onClick:i.onLessonComplete,class:"text-uppercase my-1 my-button",rounded:"lg",size:"large",variant:"elevated"},{default:s(()=>[m("done")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Ue=ae(ke,[["render",Ie],["__scopeId","data-v-5c341e1c"]]);export{Ue as default};
